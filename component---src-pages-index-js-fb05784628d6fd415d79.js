(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{RXBc:function(e,t,a){"use strict";a.r(t);var n=a("q1tI"),r=a.n(n),o=a("Bl7J"),l=a("vrFN"),c=a("tRbT"),i=a("30+C"),u=a("oa/T"),s=a("ofer"),m=a("wb2y"),d=a("zkWZ"),f=a("MBC9"),p=a("toT+"),v=a("r/f7"),h=a("sYGQ"),b=a("1KIu"),E=a("Yjo7"),y=a("oz/O"),g=a("hkVh"),k=a("6LHu"),w=a("ysvj");t.default=function(){return r.a.createElement(p.a.Consumer,null,(function(e){var t=e.isSerialAvailable,a=e.connected,n=e.commandRobot,p=e.getMosaContextWorkerPort,x=e.target,j=e.inputMethod,O=e.handleInputMethodChange,S=e.outputMethod,C=e.handleOutputMethodChange,M=e.settings,R=e.updateSettings;return r.a.createElement(o.a,null,r.a.createElement(l.a,{title:"Home"}),r.a.createElement(c.a,{container:!0,spacing:2,justify:"center"},r.a.createElement(c.a,{item:!0,xs:12,md:4,lg:3},r.a.createElement(i.a,null,r.a.createElement(u.a,null,r.a.createElement(s.a,null,"Input: ",!j&&"none selected"),r.a.createElement(d.a,{value:j,exclusive:!0,onChange:O},r.a.createElement(f.a,{value:"web"},"WEB"),r.a.createElement(f.a,{value:"remote",disabled:!0},"REMOTE")),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(s.a,null,"Output: ",!S&&"none selected"),r.a.createElement(d.a,{value:S,exclusive:!0,onChange:C},t&&r.a.createElement(f.a,{value:"serial"},"SERIAL"),r.a.createElement(f.a,{value:"visualizer"},"SR-VIS")),!t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),r.a.createElement(s.a,null,"Could not detect serial capabilities. Please use the latest version of Chrome, open"," ",r.a.createElement("code",null,"chrome://flags"),", and set",r.a.createElement("code",null,"#enable-experimental-web-platform-features")," ","(note that these are experimental features, use at your own risk, etc etc)")))),r.a.createElement("hr",null),r.a.createElement(g.a,{target:x}),r.a.createElement("hr",null),r.a.createElement(v.a,{settings:M,updateSettings:R})),r.a.createElement(c.a,{item:!0,xs:12,md:4,lg:5},r.a.createElement(h.a,{connected:a,target:x,commandRobot:n}),r.a.createElement("hr",null),r.a.createElement(E.a,{connected:a,target:x,commandRobot:n})),r.a.createElement(c.a,{item:!0,xs:12,md:4,lg:4},r.a.createElement(b.a,{connected:a,commandRobot:n}),r.a.createElement("hr",null),r.a.createElement(k.a,{connected:a,target:x,getMosaContextWorkerPort:p}),r.a.createElement("hr",null),r.a.createElement(w.a,{connected:a,target:x,getMosaContextWorkerPort:p}),r.a.createElement("hr",null),r.a.createElement(y.a,{connected:a,target:x,commandRobot:n}))),"Â ",r.a.createElement(m.a,null))}))}},ysvj:function(e,t,a){"use strict";var n=a("kD0k"),r=a.n(n),o=(a("ls82"),a("/S4K")),l=a("8o2o");function c(e){var t;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}var i=a("q1tI"),u=a.n(i),s=a("30+C"),m=a("oa/T"),d=a("ofer"),f=a("Z3vd"),p=a("cVXz"),v=a("jjAL"),h=a("6Obz"),b=a("ZGBi"),E=a("UhlP");function y(e,t){var a;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(a=e[Symbol.iterator]()).next.bind(a)}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var k=function(e){var t=e.funscripts,a=e.axis,n=e.totalTime,r=e.vpos,o=Object(l.a)(e,["funscripts","axis","totalTime","vpos"]),c=Object(i.useRef)(null);Object(i.useEffect)((function(){!function(e){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#000000",e.beginPath(),e.moveTo(400,50);for(var r,o=y(t[a].actions);!(r=o()).done;){var l=r.value,c=l.at/n*2e4+400,i=100-l.pos;e.lineTo(c,i)}e.stroke()}(c.current.getContext("2d"))}),[t,a,n]),Object(i.useEffect)((function(){var e=Math.max(Math.floor(r/n*2e4),0);document.getElementById("fiudfzdifu").scrollLeft=e}),[r,n]);var s={maxHeight:"120px",maxWidth:"800px",overflow:"hidden"};return u.a.createElement("div",{id:"fiudfzdifu",style:s},u.a.createElement("canvas",Object.assign({width:"20800px",height:"100px",ref:c},o)))},w="undefined"!=typeof window?new Worker((window.location.pathname.startsWith("/mosa/")?"/mosa/":"/")+"worker/mosaVideoPlayerWorker.js"):void 0;t.a=function(e){var t=e.connected,a=e.getMosaContextWorkerPort,n=Object(i.useState)("none"),l=n[0],g=n[1],x=Object(i.useState)([]),j=x[0],O=x[1],S=Object(i.useState)({}),C=S[0],M=S[1],R=Object(i.useState)(!1),P=R[0],I=R[1],A=Object(i.useState)(0),L=A[0],T=A[1],W=Object(i.useState)(0),V=W[0],B=W[1],F=Object(i.useState)("100"),z=F[0],D=F[1],J=Object(i.useState)(0),U=J[0],_=J[1],q=Object(i.useState)({}),H=q[0],N=q[1],Y=Object(i.useState)("none"),Z=Y[0],G=Y[1],K=[["R2",".pitch.funscript"],["R1",".roll.funscript"],["R0",".twist.funscript"],["L1",".forward.funscript"],["A1",".suck.funscript"],["L0",".funscript"]];function X(){return(X=Object(o.a)(r.a.mark((function e(t){var a,n,o,l,c,i,u,s,m,d,f,p,v,h,b;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=function(e,t){G("none"),g(e),N(t);var a=localStorage.getItem("mosaSettingsVideoLatency_"+e);a&&_(parseFloat(a)),w.postMessage(["updateParameters",{funscripts:t}]);var n=document.getElementById("idvideo");n.play(),n.ondurationchange=function(e){T(1e3*e.srcElement.duration)},n.ontimeupdate=function(e){var t=1e3*e.srcElement.currentTime;w.postMessage(["videoElementTimeMs",t]),B(t)}},!(t in C)){e.next=24;break}return n=C[t],e.t0=URL,e.next=6,n.entry.getFile();case 6:e.t1=e.sent,document.getElementById("idvideo").src=e.t0.createObjectURL.call(e.t0,e.t1),o={},l=y(K);case 10:if((c=l()).done){e.next=22;break}if(!((i=c.value)[0]in n)){e.next=20;break}return e.next=15,n[i[0]].getFile();case 15:return u=e.sent,e.next=18,u.text();case 18:s=e.sent,o[i[0]]=JSON.parse(s);case 20:e.next=10;break;case 22:return a(t,o),e.abrupt("return");case 24:for(m={},d=window.location.pathname.startsWith("/mosa/")?"/mosa/":"/",document.getElementById("idvideo").src=d+"video/"+t,f=d+"video/"+t.replaceAll(".mp4",""),p=[],v=function(){var e=b.value;p.push(fetch(f+e[1],{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((function(t){return t.json().then((function(t){return m[e[0]]=t})).catch((function(t){console.log(t),m[e[0]]=void 0}))})).catch((function(t){console.warn(t),m[e[0]]=void 0})))},h=y(K);!(b=h()).done;)v();Promise.allSettled(p).then((function(){a(t,m)}));case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(){return(Q=Object(o.a)(r.a.mark((function e(){var t,a,n,o,l,i,u,s,m,d,f,p,v,h,b,E,g,k;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.hasOwnProperty("showDirectoryPicker")){e.next=3;break}return window.alert("Your browser does not support the File System API"),e.abrupt("return");case 3:return e.next=5,window.showDirectoryPicker();case 5:t=e.sent,a={},n=!0,o=!1,e.prev=9,i=c(t.values());case 11:return e.next=13,i.next();case 13:return u=e.sent,n=u.done,e.next=17,u.value;case 17:if(s=e.sent,n){e.next=37;break}if("file"!==(m=s).kind){e.next=34;break}if(!m.name.endsWith(".mp4")){e.next=24;break}return m.name in a?a[m.name].entry=m:a[m.name]={name:m.name,entry:m},e.abrupt("continue",34);case 24:if(!m.name.endsWith(".funscript")){e.next=34;break}d=y(K);case 26:if((f=d()).done){e.next=34;break}if(p=f.value,!m.name.endsWith(p[1])){e.next=32;break}return(v=m.name.replaceAll(p[1],".mp4"))in a?a[v][p[0]]=m:a[v]=((h={name:v})[p[0]]=m,h),e.abrupt("break",34);case 32:e.next=26;break;case 34:n=!0,e.next=11;break;case 37:e.next=43;break;case 39:e.prev=39,e.t0=e.catch(9),o=!0,l=e.t0;case 43:if(e.prev=43,e.prev=44,n||null==i.return){e.next=48;break}return e.next=48,i.return();case 48:if(e.prev=48,!o){e.next=51;break}throw l;case 51:return e.finish(48);case 52:return e.finish(43);case 53:for(b=[],E=0,g=Object.keys(a);E<g.length;E++)k=g[E],b.push(k);b.sort(),O(b),M(a);case 58:case"end":return e.stop()}}),e,null,[[9,39,43,53],[44,,48,52]])})))).apply(this,arguments)}var $=function(e){document.getElementById("idvideo").playbackRate=parseFloat(e)/100,w.postMessage(["updateParameters",{playback_rate:parseFloat(e)/100}]),D(e)},ee=function(e){var t=e.key;e.target;if(!e.repeat){if(t>="1"&&t<="9"){var a=(t-"1")/8*100,n=Object.assign({},H),r=1e3*document.getElementById("idvideo").currentTime-U;n[Z].actions.push({at:Math.floor(r),pos:Math.floor(a)}),n[Z].actions.sort((function(e,t){return e.at-t.at})),N(n),w.postMessage(["updateParameters",{funscripts:H}]),console.log("Axis "+Z+" has "+n[Z].actions.length+" actions")}if("0"===t){var o=Object.assign({},H),l=document.getElementById("idvideo"),c=1e3*l.currentTime-U;o[Z].actions=o[Z].actions.filter((function(e){return e.at<c-1500||e.at>c+1500})),N(o),w.postMessage(["updateParameters",{funscripts:H}]),l.currentTime=(c-3e3+U)/1e3}var i={q:10,w:25,e:50,r:100,t:200};t in i&&$(i[t])}};Object(i.useEffect)((function(){return window.addEventListener("keydown",ee,!0),function(){return window.removeEventListener("keydown",ee,!0)}}));var te=function(e){w.postMessage(["updateParameters",{running:e}])};Object(i.useEffect)((function(){if(!(j.length>0)){var e=window.location.pathname.startsWith("/mosa/")?"/mosa/":"/";fetch(e+"video/videos.txt",{}).then((function(e){return e.text()})).then((function(e){O(e.split("\n"))}),(function(e){alert("Could not load list of video files")}))}}),[]),Object(i.useEffect)((function(){var e=a();w.postMessage(["setContextPort",e],[e])}),[]);var ae={position:"absolute",marginLeft:"399px",width:"2px",height:"100px",backgroundColor:"grey"};return Object(i.useMemo)((function(){return u.a.createElement(s.a,null,u.a.createElement(m.a,null,u.a.createElement(d.a,{variant:"h5"},"Video"),u.a.createElement("hr",null),u.a.createElement("video",{id:"idvideo",width:"100%",onPlay:function(){return te(!0)},onPause:function(){return te(!1)},controls:!0}),"none"!==Z?u.a.createElement("div",{style:ae}):"","none"!==Z?u.a.createElement(k,{vpos:V,funscripts:H,axis:Z,totalTime:L}):""),u.a.createElement(d.a,null,"File"),u.a.createElement(f.a,{onClick:function(){return function(){return Q.apply(this,arguments)}()},variant:"contained",color:"default"},"Open Client Video Folder"),u.a.createElement(p.a,{id:"idselect",value:l,onChange:function(e,t){return function(e){return X.apply(this,arguments)}(t.props.value)}},u.a.createElement(v.a,{value:"none",key:"none"},"no video"),j.map((function(e){return u.a.createElement(v.a,{value:e,key:e},e)}))),u.a.createElement(p.a,{value:z,onChange:function(e,t){return $(t.props.value)}},u.a.createElement(v.a,{value:"10",key:"10"},"10%"),u.a.createElement(v.a,{value:"25",key:"25"},"25%"),u.a.createElement(v.a,{value:"50",key:"50"},"50%"),u.a.createElement(v.a,{value:"75",key:"75"},"75%"),u.a.createElement(v.a,{value:"100",key:"100"},"100%"),u.a.createElement(v.a,{value:"200",key:"200"},"200%")),u.a.createElement(p.a,{value:Z,onChange:function(e,t){return a=t.props.value,void 0===(n=Object.assign({},H))[a]&&(n[a]={actions:[{at:0,pos:50}]},N(n),w.postMessage(["updateParameters",{funscripts:H}]),console.log("created funscript file "+a)),void G(a);var a,n}},u.a.createElement(v.a,{value:"none",key:"none"},"none"),u.a.createElement(v.a,{value:"L0",key:"main"},"Main/L0"),u.a.createElement(v.a,{value:"R2",key:"pitch"},"Pitch/R2"),u.a.createElement(v.a,{value:"R1",key:"roll"},"Roll/R1"),u.a.createElement(v.a,{value:"R0",key:"twist"},"Twist/R0"),u.a.createElement(v.a,{value:"L1",key:"forward"},"Forward/L1"),u.a.createElement(v.a,{value:"L2",key:"left"},"Left/L2"),u.a.createElement(v.a,{value:"V0",key:"vibe1"},"Vibe1/V0"),u.a.createElement(v.a,{value:"A0",key:"valve"},"Valve/A0"),u.a.createElement(v.a,{value:"A1",key:"suck"},"Suck/A1")),u.a.createElement(f.a,{onClick:function(){return function(){var e=document.createElement("a");e.setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(H[Z])));for(var t,a=".json",n=y(K);!(t=n()).done;){var r=t.value;r[0]===Z&&(a=r[1])}e.setAttribute("download",l.replaceAll(".mp4",a)),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}()},variant:"contained",color:"default",disabled:"none"===Z},"Download script"),u.a.createElement(d.a,null,"Latency"),u.a.createElement(h.a,{value:U,min:-2e3,max:2e3,step:10,track:!1,valueLabelDisplay:"auto",onChange:function(e,t){!function(e){w.postMessage(["updateParameters",{latency:e}]),_(e),localStorage.setItem("mosaSettingsVideoLatency_"+l,""+e)}(t)},marks:[{value:-1e3,label:"Video 1s early"},{value:1e3,label:"Video 1s late"}]}),u.a.createElement(b.a,{key:"moving_pauses",label:"Moving pauses",control:u.a.createElement(E.a,{checked:P,onChange:function(e){return I(!P)},name:"Moving pauses",value:"moving_pauses",color:"primary"})}))}),[t,l,j,P,L,V,z,U,H,Z])}}}]);
//# sourceMappingURL=component---src-pages-index-js-fb05784628d6fd415d79.js.map